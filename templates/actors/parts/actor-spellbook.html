<div class="inventory-filters spellbook-filters" style="margin: 0; padding-bottom: 4px;">
    <div class="flexrow"><h2 class="block-header" style="flex: 1">{{#if spellbook.orig.class}}{{ localize
        'D3Vilia.SpellBookForClass' class=spellbook.orig.class }}{{/if}}</h2><a
            class="btn configure-spellbook point-buy-button blue-button"
            for="data.attributes.spells.spellbooks.{{spellbookIndex}}" onkeydown="e.preventDefault();">
        {{ localize 'D3Vilia.Configure' }}
    </a></div>


    <!--  <div class="flexrow">-->

    <!--    <div class="form-group spellcasting-class tooltip flexrow" style="padding: 0 0 0 0.5rem; flex: 1;">-->
    <!--      <span class="tooltipcontent">@cl : {{spellbook.orig.cl.total}}</span>-->
    <!--      <label><h3>{{localize "D3Vilia.SpellcastingClass"}}</h3></label>-->
    <!--      <select name="data.attributes.spells.spellbooks.{{spellbookIndex}}.class" data-dtype="String">-->
    <!--        {{#select spellbook.orig.class}}-->
    <!--        <option value="">{{localize "D3Vilia.None"}}</option>-->
    <!--        <option value="_hd">{{localize "D3Vilia.HitDie"}}</option>-->
    <!--        {{#each data.classes as |cls a|}}-->
    <!--        <option value="{{a}}">{{cls.name}}</option>-->
    <!--        {{/each}}-->
    <!--        {{/select}}-->
    <!--      </select>-->
    <!--    </div>-->

    <!--    <div class="form-group spellcasting-ability flexrow" style="padding: 0 0.5rem 0 0.5rem; flex: 1;">-->
    <!--      <label><h3>{{localize "D3Vilia.SpellcastingAbility"}}</h3></label>-->
    <!--      <select name="data.attributes.spells.spellbooks.{{spellbookIndex}}.ability" data-dtype="String">-->
    <!--        {{#select spellbook.orig.ability}}-->
    <!--        <option value="">{{localize "D3Vilia.None"}}</option>-->
    <!--        {{#each data.abilities as |abl a|}}-->
    <!--        <option value="{{a}}">{{abl.label}}</option>-->
    <!--        {{/each}}-->
    <!--        {{/select}}-->
    <!--      </select>-->
    <!--    </div>-->
    <!--  </div>-->
    <ul class="attributes misc-defenses flexrow">
        <li class="attribute high cl tooltip" data-attribute="cl">
            <h4 class="attribute-name box-title">{{ localize 'D3Vilia.CasterLevelTotal' }}</h4>
            <div class="attribute-value">
                <span>{{spellbook.orig.cl.total}}</span>
            </div>
            <footer class="attribute-footer">

                <div class="data-selector" style="float: right; width: 60px; line-height: 24px;">
                    <a class="note-editor" for="data.attributes.spells.spellbooks.{{spellbookIndex}}.clNotes"><i
                            class="fas fa-edit"></i></a>
                    <label for="data.learnedAt.domain">Notes</label>
                </div>
                <input type="text" style="width: calc(100% - 60px);"
                       name="data.attributes.spells.spellbooks.{{spellbookIndex}}.cl.formula"
                       value="{{spellbook.orig.cl.formula}}"
                       placeholder="{{ localize 'D3Vilia.CasterLevelBonusFormula' }}"/>
            </footer>
        </li>

        <li class="attribute high concentration tooltip spellcasting-concentration" data-attribute="concentration">
            <h4 class="attribute-name box-title rollable">{{ localize 'D3Vilia.Concentration' }}
            </h4>
            <div class="attribute-value">
                <span>{{spellbook.concentration}}</span>

            </div>
            <footer class="attribute-footer">

                <div class="data-selector" style="float: right; width: 60px; line-height: 24px;">
                    <a class="note-editor"
                       for="data.attributes.spells.spellbooks.{{spellbookIndex}}.concentrationNotes"><i
                            class="fas fa-edit"></i></a>
                    <label for="data.learnedAt.domain">Notes</label>
                </div>
                <input type="text" style="width: calc(100% - 60px);"
                       name="data.attributes.spells.spellbooks.{{spellbookIndex}}.concentrationFormula"
                       value="{{spellbook.orig.concentrationFormula}}"
                       placeholder="{{ localize 'D3Vilia.ConcentrationBonusFormula' }}"/>
            </footer>
        </li>


        {{#if spellbook.orig.arcaneSpellFailure}}
        <li class="attribute high concentration tooltip spellcasting-concentration" data-attribute="concentration">
            <h4 class="attribute-name box-title">{{ localize 'D3Vilia.ArcaneSpellFailure' }}</h4>
            <div class="attribute-value" style="font-size: 34px; line-height: 34px;">
                <span>{{spellFailure}}%</span>
            </div>
        </li>
        {{/if}}

        {{#if spellbook.orig.usePowerPoints}}
        <li class="attribute high powerPoints tooltip" data-attribute="powerPoints">
            <h4 class="attribute-name box-title">{{ localize 'D3Vilia.PowerPoints' }}</h4>
            <div class="attribute-value">

                <input type="text" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.powerPoints"
                       value="{{spellbook.orig.powerPoints}}" placeholder="{{ localize 'D3Vilia.PowerPoints' }}"
                       data-dtype="Number"/>
            </div>
            <footer class="attribute-footer">
                <input type="text" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.dailyPowerPointsFormula"
                       value="{{spellbook.orig.dailyPowerPointsFormula}}"
                       placeholder="{{ localize 'D3Vilia.DailyPowerPointsFormula' }}"/>
            </footer>
        </li>
        {{/if}}

        {{#if spellbook.orig.hasPrestigeCl}}
        <li class="attribute high powerPoints tooltip" data-attribute="powerPoints">
            <h4 class="attribute-name box-title">{{ localize 'D3Vilia.PrestigeCL' }}
                ({{spellbook.spellcastingTypeName}})</h4>
            <div class="attribute-value flexrow">
                {{#if spellbook.orig.canRemovePrestigeCl}}
                <a class="remove-prestige-cl"><i class="fas fa-minus"></i></a>
                {{else}}
                <a class="remove-prestige-cl-disabled"><i class="fas fa-minus"></i></a>
                {{/if}}
                <input type="text" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.bonusPrestigeCl"
                       value="{{spellbook.orig.bonusPrestigeCl}}" placeholder="{{ localize 'D3Vilia.PowerPoints' }}"
                       data-dtype="Number"/>

                {{#if spellbook.orig.canAddPrestigeCl}}
                <a class="add-prestige-cl"><i class="fas fa-plus"></i></a>
                {{else}}
                <a class="add-prestige-cl-disabled"><i class="fas fa-plus"></i></a>
                {{/if}}
            </div>
            <footer class="attribute-footer tooltip">
                <span>{{spellbook.orig.availablePrestigeCl}}</span>
                <span class="sep">/</span>
                <span>{{spellbook.orig.maxPrestigeCl}}</span>
                {{#if spellbook.data.maxPrestigeClSources.length}}
                <span class="tooltipcontent">

                <br/><br/>{{ localize 'D3Vilia.FromSources' }}:<br/>
                {{#each spellbook.data.maxPrestigeClSources as |src|}}{{src.name}}: {{src.value}}<br/>{{/each}}
            </span>
                {{/if}}
            </footer>
        </li>

        {{/if}}
    </ul>
    <!--  <div class="flexrow">-->
    <!--    <div class="flexcol">-->
    <!--      <div class="flexrow formulas">-->
    <!--        <label><h3>{{localize "D3Vilia.BaseDCFormula"}}</h3></label>-->
    <!--        <input type="text" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.baseDCFormula"-->
    <!--        value="{{spellbook.orig.baseDCFormula}}" placeholder="{{localize "D3Vilia.BaseDCFormula"}}" />-->
    <!--      </div>-->


    <!--    </div>-->
    <!--    -->
    <!--    <div class="flexcol">-->
    <!--      <label class="checkbox">-->
    <!--        <input type="checkbox" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.autoSpellLevels"-->
    <!--        {{checked spellbook.orig.autoSpellLevels}}/> {{localize "D3Vilia.AutomaticSpellSlots"}}-->
    <!--      </label>-->
    <!--      <label class="checkbox">-->
    <!--        <input type="checkbox" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.spontaneous"-->
    <!--        {{checked spellbook.orig.spontaneous}}/> {{localize "D3Vilia.SpellPrepSpontaneous"}}-->
    <!--      </label>-->
    <!--    </div>-->
    <!--    <div class="flexcol">-->
    <!--      <label class="checkbox">-->
    <!--        <input type="checkbox" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.arcaneSpellFailure"-->
    <!--        {{checked spellbook.orig.arcaneSpellFailure}}/> {{localize "D3Vilia.ArcaneSpellFailure"}}-->
    <!--      </label>-->

    <!--      <label class="checkbox">-->
    <!--        <input type="checkbox" name="data.attributes.spells.spellbooks.{{spellbookIndex}}.usePowerPoints"-->
    <!--               {{checked spellbook.orig.usePowerPoints}}/> {{localize "D3Vilia.UsePowerPoints"}}-->
    <!--      </label>-->
    <!--    </div>-->
    <!--  </div>-->


</div>

<ol class="inventory-list sub-scroll scroll-spellbooks">
    {{#if spellbook.isSpellLike}}
    <li class="flexrow inventory-header spellbook-header scrolling-header">
        <div class="item-name flexrow">
            <h3>{{section.label}}</h3>
        </div>

        <div class="item-detail item-actions"><span>{{ localize 'D3Vilia.ActionPlural' }}</span></div>

        <div class="spell-uses">
        </div>

        <!--        <div class="spell-school">{{localize "D3Vilia.SpellSchool"}}</div>-->

        <div class="item-controls">
            {{#if spellbook.canCreate}}
            <a class="open-compendium-pack" data-pack="browser:spells" title="{{ localize 'D3Vilia.CreateItem' }}"
               data-type="spell" data-level="1" data-spellbook="spelllike">
            <i class="fas fa-atlas"></i> {{ localize 'D3Vilia.Add' }}
            </a>
            <a class="item-control item-create" style="flex: 0; margin-left: 4px;"
               title="{{ localize 'D3Vilia.CreateSpell' }}"
               data-type="spell" data-level="1" data-spellbook="spelllike">
            <i class="fas fa-plus"></i> {{ localize 'D3Vilia.New' }}
            </a>
            {{/if}}
        </div>
    </li>
    {{/if}}
    {{#each spellbook.data as |section sid|}}
    <div class="inventory-sublist" data-sublist-id="spellbook-{{../spellbookIndex}}-{{sid}}">
    {{#unless ../spellbook.isSpellLike }}
    <li class="flexrow inventory-header spellbook-header scrolling-header">
        <div class="item-name inventory-toggleable-header flexrow">
            <h3><i class="fas fa-folder-open toggle-open"></i><i class="fas fa-folder toggle-close" style="display: none"></i>{{section.label}} {{#if section.maxKnown}}<span  style="{{#if section.knownOverLimit}}color: darkred{{/if}}">({{section.known}}/{{section.maxKnown}} known){{/if}}</span></h3>
        </div>

        <div class="item-detail item-actions"><span>{{ localize 'D3Vilia.ActionPlural' }}</span></div>
        {{#unless section.isEpic}}
        <div class="spell-uses">
            {{#if section.usePowerPoints}}
            <input type="text" disabled value="{{section.powerPoints}}" placeholder="0" data-dtype="Number"/>
            {{ else }}
            {{#unless ../spellbook.orig.spontaneous}}
            {{#unless ../spellbook.orig.autoSpellLevels}}
            <input class="base" type="text"
                   name="data.attributes.spells.spellbooks.{{../spellbookIndex}}.spells.spell{{section.level}}.base"
                   value="{{section.baseSlots}}" placeholder="Base"/>
            {{/unless}}
            <span>Slots</span><input type="text" disabled value="{{section.slots}}" placeholder="0"
                                     data-dtype="Number"/>
            {{ else }}
            {{#unless ../spellbook.orig.autoSpellLevels}}
            <input class="base" type="text"
                   name="data.attributes.spells.spellbooks.{{../spellbookIndex}}.spells.spell{{section.level}}.base"
                   value="{{section.baseSlots}}" placeholder="Base"/>
            {{/unless}}
            <input type="text" value="{{section.uses}}"
                   name="data.attributes.spells.spellbooks.{{../spellbookIndex}}.spells.spell{{section.level}}.value"
                   placeholder="0" data-dtype="Number"/>
            <span class="sep"> / </span>
            <input type="text" value="{{section.slots}}" disabled placeholder="0" data-dtype="Number"/>
            {{/unless}}
            {{/if}}
        </div>
        {{else}}

        <div class="spell-uses">
        </div>
        {{/unless}}

        <!--        <div class="spell-school">{{localize "D3Vilia.SpellSchool"}}</div>-->

        <div class="item-controls">
            {{#if section.canCreate}}
            <a class="open-compendium-pack" data-pack="browser:spells" title="{{ localize 'D3Vilia.CreateItem' }}" {{#each
               section.dataset as |v k|}}data-{{k}}="{{v}}" {{/each}}>
            <i class="fas fa-atlas"></i> {{ localize 'D3Vilia.Add' }}
            </a>
            <a class="item-control item-create" style="flex: 0; margin-left: 4px;"
               title="{{ localize 'D3Vilia.CreateSpell' }}" {{#each section.dataset as |v k|}}data-{{k}}="{{v}}" {{/each}}>
            <i class="fas fa-plus"></i> {{ localize 'D3Vilia.New' }}
            </a>
            {{/if}}
        </div>
    </li>
    {{/unless}}
    <ol class="item-list spellbook-list" data-level="{{section.level}}" style="position: relative">
        {{#each section.spells as |item i|}}
        <li class="item flexrow" data-level="{{section.level}}" data-item-id="{{item._id}}"
            data-replacement-id="{{section.spellReplacementId}}">
            <div class="item-name flexrow rollable {{#if item.isSpecialized}}item-specialized{{/if}}{{#if item.isBanned}}item-banned{{/if}}">
                <div class="item-image" style="background-image: url('{{item.img}}')"></div>
                <h4>{{item.name}}

                    {{#if item.epic}}
                    (level {{item.epicLevel}})
                    {{/if}}
                    {{#if item.data.specialPrepared}}
                    <i class="fas fa-hand-sparkles tooltip">
                        <span class="tooltipcontent" style="z-index: 999">{{localize "D3Vilia.SpecialSlotPrepared"}}</span>
                    </i>
                    {{/if}}
                    {{#if item.data.isSpellSpontaneousReplacement}}
                    <i class="fas fa-heart tooltip">
                        <span class="tooltipcontent" style="z-index: 999">{{localize "D3Vilia.SpellReplacement"}}</span>
                    </i>
                    {{/if}}

                    {{#if item.isSpecialized}}
                    <i class="fas fa-sun tooltip">
                        <span class="tooltipcontent" style="z-index: 999">{{localize "D3Vilia.SpellSpecialized"}}</span>
                    </i>
                    {{/if}}

                    {{#if item.isBanned}}
                    <i class="fas fa-ban tooltip">
                        <span class="tooltipcontent" style="z-index: 999">{{localize "D3Vilia.SpellBanned"}}</span>
                    </i>
                    {{/if}}

                    {{#unless @root.hideShortDescriptions}}
                    <em style="color: black; opacity: 0.7" class="non-rollable">{{item.data.snip}}</em>
                    {{/unless}}
                </h4>
            </div>

            <div class="item-detail item-actions">
                <div class="item-attack">
                    <a class="item-control item-attack"><img class="icon" src="systems/D3Vilia/icons/actions/gladius.svg"></a>
                </div>

                {{#if section.hasSpontaneousSpellReplacement}}
                <div class="item-attack tooltip">
            <span class="tooltipcontent">{{localize "D3Vilia.CastAsReplacement"}}
              <br>
              {{localize "D3Vilia.CastAsReplacementDesc"}} {{section.spellReplacementName}}</span>
                    <a class="item-control item-attack-convert"><i class="fas fa-heart"
                                                                   style="color: white !important;"></i></a>
                </div>
                {{/if}}
            </div>

            <div class="spell-uses flexrow">

                {{#if item.data.atWill}}
                <em style="opacity: 0.7">{{localize "D3Vilia.SpellPrepAtWill"}}</em>
                {{else}}
                {{#if section.usePowerPoints}}
                <input type="text" value="{{item.data.powerPointsCost}}" disabled data-type="max" data-dtype="Number"/>
                {{ else }}
                {{#unless section.spontaneous}}
                <input type="text" value="{{item.data.preparation.preparedAmount}}" data-type="amount"
                       data-dtype="Number"/>
                <span class="sep"> / </span>
                <input type="text" value="{{item.data.preparation.maxAmount}}" data-type="max" data-dtype="Number"/>

                <a class="item-control spell-add-uses" title="{{ localize 'D3Vilia.PrepareSpell' }}">

                    {{#if item.data.specialPrepared}}
                    {{#unless item.data.preparation.maxAmount}}
                    <i class="fas fa-plus"></i>
                    {{/unless}}
                    {{else}}
                    {{#if section.slotsLeft}}
                    <i class="fas fa-plus"></i>
                    {{/if}}
                    {{#if item.epic}}
                    <i class="fas fa-plus"></i>
                    {{/if}}
                    {{/if}}
                </a>

                <a class="item-control spell-remove-uses" title="{{ localize 'D3Vilia.UnprepareSpell' }}">
                    <i class="fas fa-minus"></i>
                </a>


                {{#if ../../spellbook.orig.hasSpecialSlot}}
                {{#unless item.data.specialPrepared}}

                {{#if section.slots}}
                {{#if item.isSpecialized}}
                <a class="item-control spell-prepare-special" title="{{ localize 'D3Vilia.PrepareAsSpecialSpell' }}">
                    <i class="fas fa-hand-sparkles"></i>
                </a>
                {{else}}
                <div style="flex: 0 16px;"></div>
                {{/if}}
                {{else}}
                <div style="flex: 0 16px;"></div>
                {{/if}}
                {{else}}
                <div style="flex: 0 16px;"></div>
                {{/unless}}
                {{else}}
                <div style="flex: 0 16px;"></div>
                {{/if}}
                {{#if 1}}
                <a class="item-control spell-add-metamagic" title="{{ localize 'D3Vilia.PrepareMetamagicSpell' }}">
                    <i class="fas fa-arrow-circle-up"></i>
                </a>
                {{else}}
                <div style="flex: 0 16px;"></div>
                {{/if}}
                {{else}}

                <div style="flex: 0 16px;"></div>
                <div style="flex: 0 16px;"></div>
                {{#if 1}}
                <a class="item-control spell-add-metamagic" title="{{ localize 'D3Vilia.PrepareMetamagicSpell' }}">
                    <i class="fas fa-arrow-circle-up"></i>
                </a>
                {{else}}
                <div style="flex: 0 16px;"></div>
                {{/if}}
                {{/unless}}

                {{/if}}
                {{/if}}
            </div>

            <!--          <div class="spell-school">{{labels.school}}</div>-->

            {{#if ../../owner}}
            <div class="item-controls">
                <a class="item-control item-edit" title="{{ localize 'D3Vilia.EditItem' }}"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="{{ localize 'D3Vilia.DeleteItem' }}"><i
                        class="fas fa-trash"></i></a>
            </div>
            {{/if}}
        </li>
        {{/each}}
        {{#unless section.hasNonDomainSpells}}
        {{#if ../spellbook.orig.allSpellsKnown}}
        <li class="item flexrow">
            <div class="item-name flexrow rollable add-all-known-spells" style="opacity: 0.8; text-align: center">
          <span>{{localize "D3Vilia.AddAllKnownSpells"}}
          </span>
            </div>
        </li>
        {{/if}}
        {{/unless}}
        {{#if ../spellbook.orig.hasSpecialSlot}}
        {{#unless section.specialSlotPrepared}}
        {{#if section.level}}
        {{#if section.slots}}
        <li class="item flexrow" data-item-id="{{item._id}}" data-replacement-id="{{section.spellReplacementId}}">
            <div class="item-name flexrow" style="opacity: 0.8; text-align: center">
                <em>{{localize "D3Vilia.SpellbookDescUse"}}
                    <i class="fas fa-hand-sparkles">
                    </i>
                    {{localize "D3Vilia.SpellbookDescToPrepareSpell"}}
                </em>
            </div>
        </li>
        {{/if}}
        {{/if}}
        {{/unless}}
        {{/if}}
    </ol>
    </div>
    {{/each}}
</ol>
<div class="flexrow spell-range" style="">
    <span><strong>Range</strong></span>
    <label><span>{{ localize 'D3Vilia.DistClose' }}</span></label>
    <input type="text" value="{{spellbook.orig.range.close}}" disabled/>
    <label><span>{{ localize 'D3Vilia.DistMedium' }}</span></label>
    <input type="text" value="{{spellbook.orig.range.medium}}" disabled/>
    <label><span>{{ localize 'D3Vilia.DistLong' }}</span></label>
    <input type="text" value="{{spellbook.orig.range.long}}" disabled/>
</div>
